# ç´«å¾®æ–—æ•°å‘½ç†åˆ†æç³»ç»Ÿ

åŸºäº Vite + React + TypeScript + Tailwind CSS çš„ç°ä»£åŒ–ç´«å¾®æ–—æ•°å‘½ç†åˆ†æç³»ç»Ÿï¼Œé‡‡ç”¨ LangGraph çŠ¶æ€æœºæ¶æ„ + RAG æ£€ç´¢å¢å¼ºï¼Œé›†æˆ iztro å‘½ç›˜è®¡ç®—å¼•æ“ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¯ **å¤§ç±»é€‰æ‹©**ï¼šæ”¯æŒç´«å¾®æ–—æ•°ã€å…«å­—å‘½ç†ã€å¥‡é—¨éç”²ã€å…­çˆ»é¢„æµ‹ã€æ‰‹ç›¸å åœ
- ğŸ“… **å‡ºç”Ÿä¿¡æ¯é‡‡é›†**ï¼šæ”¯æŒé˜³å†/å†œå†ã€åäºŒæ—¶è¾°ã€æ€§åˆ«é€‰æ‹©
- ğŸŒŸ **å‘½ç›˜ç”Ÿæˆ**ï¼šåŸºäº iztro åº“å®ç°ç²¾å‡†çš„ç´«å¾®æ–—æ•°å‘½ç›˜æ’ç›˜
- ğŸ’¬ **æ™ºèƒ½å¯¹è¯**ï¼šåŸºäº LangGraph çŠ¶æ€æœºçš„ AI Agent å¯¹è¯ç³»ç»Ÿ
- ğŸ“š **çŸ¥è¯†åº“æ£€ç´¢**ï¼šæ··åˆå‘é‡æ£€ç´¢ + BM25 å…³é”®è¯æ£€ç´¢ + GraphRAG
- ğŸ¨ **ç²¾ç¾ UI**ï¼šæ˜Ÿç©ºä¸»é¢˜è®¾è®¡ï¼Œç»ç’ƒæ€å¡ç‰‡ï¼Œæµç•…åŠ¨ç”»

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯
- **æ¡†æ¶**ï¼šVite + React 18
- **è¯­è¨€**ï¼šTypeScript
- **æ ·å¼**ï¼šTailwind CSS
- **çŠ¶æ€ç®¡ç†**ï¼šZustand
- **åŠ¨ç”»**ï¼šFramer Motion
- **å‘½ç›˜è®¡ç®—**ï¼šiztro

### åç«¯ (Express + LangGraph)
- **AI å¼•æ“**ï¼šDeepSeek / MiniMax / Claude
- **æ¶æ„æ¨¡å¼**ï¼šLangGraph çŠ¶æ€æœº
- **æ£€ç´¢å¢å¼º**ï¼šæ··åˆå‘é‡æ£€ç´¢ (Chroma + BM25)

### RAG æœåŠ¡ (Python FastAPI)
- **å‘é‡æ•°æ®åº“**ï¼šChroma (æŒä¹…åŒ–å­˜å‚¨)
- **Embedding**ï¼šOpenAI text-embedding-3-small
- **å…³é”®è¯æ£€ç´¢**ï¼šBM25 (jieba åˆ†è¯)
- **é‡æ’åº**ï¼šCross-Encoder

## ğŸ“ é¡¹ç›®ç»“æ„

```
ziwei-destiny/
â”œâ”€â”€ frontend/                 # å‰ç«¯é¡¹ç›® (React)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/       # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/         # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ chartService.ts      # å‘½ç›˜æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ agentService.ts      # Agent æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ prompts/             # Prompt æ„å»ºå™¨
â”‚   â”‚   â”œâ”€â”€ store/            # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ App.tsx           # ä¸»ç»„ä»¶
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ backend/                  # åç«¯é¡¹ç›® (Express + TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ graph/            # LangGraph çŠ¶æ€æœº
â”‚   â”‚   â”‚   â”œâ”€â”€ destinyGraph.ts     # å›¾å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ nodes.ts            # èŠ‚ç‚¹å®ç° (å« retrieveRAGNode)
â”‚   â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ ragService.ts       # RAG å®¢æˆ·ç«¯ (NEW)
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts          # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ backend-rag/              # RAG æœåŠ¡ (Python FastAPI) (NEW)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py           # API ç«¯ç‚¹
â”‚   â”‚   â”œâ”€â”€ config.py         # é…ç½®
â”‚   â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ enums.py      # DestinyType, RetrievalStrategy
â”‚   â”‚   â”‚   â””â”€â”€ schemas.py    # KnowledgeEntry, SearchResult
â”‚   â”‚   â””â”€â”€ services/         # æ ¸å¿ƒæœåŠ¡
â”‚   â”‚       â”œâ”€â”€ chroma_service.py      # å‘é‡å­˜å‚¨
â”‚   â”‚       â”œâ”€â”€ bm25_service.py        # å…³é”®è¯æ£€ç´¢
â”‚   â”‚       â”œâ”€â”€ embedding_service.py   # Embedding
â”‚   â”‚       â”œâ”€â”€ reranker_service.py    # é‡æ’åº
â”‚   â”‚       â”œâ”€â”€ router.py              # æŸ¥è¯¢è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ planner.py             # ç­–ç•¥è§„åˆ’
â”‚   â”‚       â”œâ”€â”€ hybrid_retriever.py    # æ··åˆæ£€ç´¢
â”‚   â”‚       â”œâ”€â”€ graphrag_retriever.py  # GraphRAG
â”‚   â”‚       â”œâ”€â”€ cross_type_retriever.py # è·¨ç±»å‹
â”‚   â”‚       â””â”€â”€ rag_engine.py          # RAG å¼•æ“
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ init_knowledge.py   # åˆå§‹åŒ–çŸ¥è¯†åº“
â”‚   â”‚   â””â”€â”€ migrate_knowledge.py # è¿ç§»è„šæœ¬
â”‚   â””â”€â”€ requirements.txt        # Python ä¾èµ–
â”‚
â””â”€â”€ package.json              # æ ¹é¡¹ç›®é…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- npm >= 9.0.0
- Python >= 3.10 (ç”¨äº RAG æœåŠ¡)

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
npm run install:all
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# åç«¯é…ç½®
cd backend
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥ DeepSeek API Key

# RAG æœåŠ¡é…ç½®
cd ../backend-rag
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥ OpenAI API Key (ç”¨äº Embedding)
```

### 3. åˆå§‹åŒ– RAG çŸ¥è¯†åº“

```bash
cd backend-rag

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# åˆå§‹åŒ–çŸ¥è¯†åº“
python scripts/init_knowledge.py
```

### 4. å¯åŠ¨æœåŠ¡

**æ–¹å¼ä¸€ï¼šåŒæ—¶å¯åŠ¨æ‰€æœ‰æœåŠ¡**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd backend-rag
source venv/bin/activate
python -m app.main &  # åå°å¯åŠ¨ RAG æœåŠ¡ (ç«¯å£ 8001)
cd ..

npm run dev           # å¯åŠ¨å‰åç«¯ (ç«¯å£ 3000, 8000)
```

**æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨**

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ RAG æœåŠ¡
cd backend-rag
source venv/bin/activate
python -m app.main  # ç«¯å£ 8001

# ç»ˆç«¯ 2: å¯åŠ¨åç«¯
cd backend
npm run dev          # ç«¯å£ 8000

# ç»ˆç«¯ 3: å¯åŠ¨å‰ç«¯
cd frontend
npm run dev          # ç«¯å£ 3000
```

### 5. è®¿é—®ç³»ç»Ÿ

æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000

## ğŸ“– RAG ç³»ç»Ÿè¯´æ˜

### æ£€ç´¢ç­–ç•¥

ç³»ç»Ÿæ ¹æ®é—®é¢˜ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ£€ç´¢ç­–ç•¥ï¼š

| ç­–ç•¥ | æè¿° | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| HYBRID_VECTOR | å‘é‡ + BM25 + Reranker | ç®€å•é—®é¢˜ã€æ¦‚å¿µæŸ¥è¯¢ |
| GRAPH_LOCAL | åŸºäºå®ä½“çš„å›¾è°±æ£€ç´¢ | æ¶‰åŠæ˜Ÿæ›œå…³ç³»çš„åˆ†æ |
| GRAPH_GLOBAL | åŸºäºç¤¾åŒºæ‘˜è¦çš„æ£€ç´¢ | å¤æ‚æ¨ç†ã€å¤šå®ä½“æ¯”è¾ƒ |
| CROSS_TYPE | è·¨å‘½ç†ç±»å‹æ£€ç´¢ | æ¶‰åŠäº”è¡Œç­‰å…±é€šæ¦‚å¿µ |

### çŸ¥è¯†åº“ç»„ç»‡

```
shared (å…±é€šçŸ¥è¯†)
â”œâ”€â”€ äº”è¡Œç†è®º
â”œâ”€â”€ å¤©å¹²åœ°æ”¯
â””â”€â”€ é˜´é˜³å­¦è¯´

ziwei (ç´«å¾®æ–—æ•°)
â”œâ”€â”€ palace (å®«ä½)
â”œâ”€â”€ star (æ˜Ÿæ›œ)
â”œâ”€â”€ transformation (å››åŒ–)
â”œâ”€â”€ fortune (è¿åŠ¿)
â””â”€â”€ pattern (æ ¼å±€)

bazi (å…«å­—å‘½ç†)
â”œâ”€â”€ structure (æ ¼å±€)
â”œâ”€â”€ yongshen (ç”¨ç¥)
â”œâ”€â”€ ten_gods (åç¥)
â””â”€â”€ dayun (å¤§è¿æµå¹´)

qimen (å¥‡é—¨éç”²)
â”œâ”€â”€ nine_star (ä¹æ˜Ÿ)
â”œâ”€â”€ eight_door (å…«é—¨)
â””â”€â”€ eight_god (å…«ç¥)
```

### API ç«¯ç‚¹

**RAG æœåŠ¡ (ç«¯å£ 8001)**

```bash
# å¥åº·æ£€æŸ¥
GET /health

# æ£€ç´¢æŸ¥è¯¢
POST /api/rag/search
POST /api/rag/query

# çŸ¥è¯†ç®¡ç†
POST /api/knowledge/upload    # ä¸Šä¼ æ–‡æ¡£
POST /api/knowledge/text      # æ·»åŠ æ–‡æœ¬
GET /api/knowledge/stats      # ç»Ÿè®¡ä¿¡æ¯
GET /api/knowledge/documents  # æ–‡æ¡£åˆ—è¡¨
```

## ğŸ”„ ç³»ç»Ÿæµç¨‹

```
ç”¨æˆ·é€‰æ‹©å¤§ç±» (ç´«å¾®æ–—æ•°)
        â†“
è¾“å…¥å‡ºç”Ÿä¿¡æ¯ (å¹´æœˆæ—¥ã€æ—¶è¾°ã€æ€§åˆ«ã€å†œå†/é˜³å†)
        â†“
iztro ç”Ÿæˆå‘½ç›˜
        â†“
å±•ç¤ºå‘½ç›˜ â†’ é€‰æ‹©åˆ†æç±»åˆ«
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LangGraph Agent + RAG                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  router â†’ retrieveCareer/retrieveRAG â†’ analyze â†’ respond â”‚
â”‚                      â†“                                   â”‚
â”‚           RAG æ£€ç´¢ç­–ç•¥é€‰æ‹©                                â”‚
â”‚           â”œâ”€ ç®€å•é—®é¢˜ â†’ æ··åˆå‘é‡æ£€ç´¢                      â”‚
â”‚           â””â”€ å¤æ‚é—®é¢˜ â†’ GraphRAG                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
è¿”å›åˆ†æç»“æœï¼Œç»§ç»­å¯¹è¯äº¤äº’
```

## ğŸ“š çŸ¥è¯†åº“åˆ†ç±»

### é€šç”¨åˆ†ç±»

| åˆ†ç±» | æè¿° | å…³è”å®«ä½/æ¦‚å¿µ |
|------|------|--------------|
| äº‹ä¸šè¿åŠ¿ | å·¥ä½œå‘å±•ã€èŒåœºæœºé‡ | å®˜ç¦„å®«ã€å‘½å®«ã€è¿ç§»å®« |
| è´¢è¿åˆ†æ | è´¢å¯Œè¿åŠ¿ã€æŠ•èµ„ç†è´¢ | è´¢å¸›å®«ã€ç”°å®…å®« |
| æ„Ÿæƒ…å§»ç¼˜ | æ¡ƒèŠ±è¿åŠ¿ã€å©šå§»é…å¯¹ | å¤«å¦»å®«ã€å­å¥³å®« |
| å¥åº·è¿åŠ¿ | èº«ä½“çŠ¶å†µã€å…»ç”Ÿå»ºè®® | ç–¾å„å®«ã€å‘½å®« |
| å®¶åº­äº²ç¼˜ | å…­äº²å…³ç³»ã€å®¶åº­è¿åŠ¿ | çˆ¶æ¯å®«ã€å…„å¼Ÿå®« |

### ç´«å¾®æ–—æ•°ä¸“å±åˆ†ç±»

| åˆ†ç±» | æè¿° |
|------|------|
| ziweigeju | ç´«å¾®æ ¼å±€åˆ†æ |
| sixi | å››åŒ–é£æ˜Ÿåˆ†æ |
| dashun | å¤§è¿åˆ†æ |

### å…«å­—å‘½ç†ä¸“å±åˆ†ç±»

| åˆ†ç±» | æè¿° |
|------|------|
| geju | å…«å­—æ ¼å±€åˆ†æ |
| yongshen | ç”¨ç¥åˆ†æ |
| shishen | åç¥åˆ†æ |
| dayun | å¤§è¿æµå¹´ |

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¯¦è§£

### iztro å‘½ç›˜è®¡ç®—

ä½¿ç”¨ iztro åº“è¿›è¡Œç´«å¾®æ–—æ•°æ’ç›˜ï¼Œæ”¯æŒï¼š
- é˜³å†/å†œå†æ—¥æœŸè½¬æ¢
- åäºŒå®«ä½è®¡ç®—
- ä¸»æ˜Ÿã€è¾…æ˜Ÿã€æ‚æ›œå®‰æ”¾
- å››åŒ–é£æ˜Ÿ
- å¤§é™æµå¹´

### LangGraph çŠ¶æ€æœº

é‡‡ç”¨ LangGraph é£æ ¼çš„çŠ¶æ€æœºæ¶æ„ï¼š
- èŠ‚ç‚¹ï¼šrouter, retrieve*, analyze, respond
- è¾¹ï¼šæ¡ä»¶è½¬æ¢è§„åˆ™
- çŠ¶æ€ï¼šæ¶ˆæ¯å†å²ã€å‘½ç›˜æ•°æ®ã€æ£€ç´¢ç»“æœã€metadata

### RAG æ£€ç´¢å¢å¼º

- **å‘é‡æ£€ç´¢**ï¼šOpenAI Embedding + Chroma
- **å…³é”®è¯æ£€ç´¢**ï¼šjieba åˆ†è¯ + BM25
- **é‡æ’åº**ï¼šCross-Encoder
- **GraphRAG**ï¼šå®ä½“å…³ç³» + ç¤¾åŒºæ‘˜è¦
- **è·¨ç±»å‹æ£€ç´¢**ï¼šå…±é€šçŸ¥è¯†è¡¥å……

## ğŸ“ å¼€å‘è®¡åˆ’

- [x] ç´«å¾®æ–—æ•°æ¨¡å—
- [x] RAG å‘é‡æ£€ç´¢ç³»ç»Ÿ (NEW)
- [ ] å…«å­—å‘½ç†æ¨¡å—
- [ ] å¥‡é—¨éç”²æ¨¡å—
- [ ] å…­çˆ»é¢„æµ‹æ¨¡å—
- [ ] æ‰‹ç›¸å åœæ¨¡å—
- [ ] å¤§é™æµå¹´åˆ†æ
- [ ] å‘½ç›˜å¯¹æ¯”åŠŸèƒ½
- [ ] ç”¨æˆ·å†å²è®°å½•

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
npm run install:all

# å¼€å‘å¯åŠ¨
npm run dev
npm run dev:frontend
npm run dev:backend

# æ„å»º
npm run build
npm run build:frontend
npm run build:backend

# RAG æœåŠ¡
cd backend-rag
source venv/bin/activate
python -m app.main          # å¯åŠ¨
python scripts/init_knowledge.py  # åˆå§‹åŒ–çŸ¥è¯†åº“
```

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [iztro](https://github.com/SylarLong/iztro) - ç´«å¾®æ–—æ•°æ’ç›˜åº“
- [DeepSeek](https://deepseek.com) - AI å¯¹è¯å¼•æ“
- [OpenAI](https://openai.com) - Embedding æ¨¡å‹
- [Chroma](https://trychroma.com) - å‘é‡æ•°æ®åº“
- [Tailwind CSS](https://tailwindcss.com) - CSS æ¡†æ¶
- [Framer Motion](https://www.framer.com/motion/) - åŠ¨ç”»åº“
